<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             684453ffd43c2             |
    |_______________________________________|
*/
 namespace Pmpr\Module\WoocommerceInvoice; use DateTime; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Module\WoocommerceInvoice\Email\Customer; use Pmpr\Module\WoocommerceInvoice\Model\Invoice; use WC_Order; use WC_Order_Item_Product; use WP_Error; use WP_Post; class Engine extends Container { const ikwcgqkqmakcmwwg = WoocommerceInvoice::ccwyisoeggcoicio . 'pdf_'; const kyicykyuagcqogqm = 'tax'; const keeemscwmacsykou = 'price_inc'; const augaaessqicgceuq = 'total_inc'; const euacueckgccyumqw = 'totals'; const uugwyiqaimqysamw = 'subtotal'; const kockquwamkwwwwok = 'shipping'; const uueoqmeyyeiqyuku = 'discount'; public function mgqkkcauyaumqsgk($umwqusowiqmyseom) { $iymiiogckyomckqk = null; $eioamqeaccimmisg = $this->wqykqagkwekacukq($umwqusowiqmyseom); if (!empty($eioamqeaccimmisg) && !is_wp_error($eioamqeaccimmisg)) { $iymiiogckyomckqk = $this->yiesgoeqwoqskisc($umwqusowiqmyseom, $eioamqeaccimmisg); } return ['pdf' => $iymiiogckyomckqk, 'invoice' => $eioamqeaccimmisg]; } public function wqykqagkwekacukq($umwqusowiqmyseom, $eioamqeaccimmisg = null) { $gkkgcoiwayaccqgm = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->iooowgsqoyqseyuu($umwqusowiqmyseom); if ($gkkgcoiwayaccqgm) { if (empty($eioamqeaccimmisg)) { $eioamqeaccimmisg = $this->imasugowgqyekses($gkkgcoiwayaccqgm); } if (empty($eioamqeaccimmisg)) { $egaioscwooawuigc = $this->aioemwomyweyeoug($gkkgcoiwayaccqgm); $icwicymcioeyeyek = [Constants::qescuiwgsyuikume => $this->eacciqkqyiyiawiy($umwqusowiqmyseom, Setting::wmamggmmccsqcqwa), Constants::geykusaewkemcasi => $gkkgcoiwayaccqgm, Invoice::qiookqywwgemeamk => $this->eacciqkqyiyiawiy($umwqusowiqmyseom, Setting::qiookqywwgemeamk), Invoice::kwmkawqoiesweswy => $this->eacciqkqyiyiawiy($umwqusowiqmyseom, Setting::kwmkawqoiesweswy), Invoice::wsccocqiicegwska => $this->eacciqkqyiyiawiy($umwqusowiqmyseom, Setting::wsccocqiicegwska), Invoice::aockomuqgkgqyaki => $this->eacciqkqyiyiawiy($umwqusowiqmyseom, Setting::aockomuqgkgqyaki), Invoice::aeoiqogeqsmoaaai => $egaioscwooawuigc, Invoice::kosymqioioyguigs => $this->eacciqkqyiyiawiy($umwqusowiqmyseom, Setting::kosymqioioyguigs), Invoice::ekyyyewmowkgcgay => $this->eacciqkqyiyiawiy($umwqusowiqmyseom, Setting::ekyyyewmowkgcgay), Invoice::qaowyaoaqwacmgeo => $this->eacciqkqyiyiawiy($umwqusowiqmyseom, Setting::qaowyaoaqwacmgeo), Invoice::iwgggmqikoqacewk => $this->oemgogkymyscaiiw($gkkgcoiwayaccqgm, $egaioscwooawuigc)]; $sogksuscggsicmac = Invoice::symcgieuakksimmu()->gssiscqyqsacmeca()->gsegsiocqmsoayii($icwicymcioeyeyek); if (is_wp_error($sogksuscggsicmac)) { $eioamqeaccimmisg = $sogksuscggsicmac; } else { $eioamqeaccimmisg = $sogksuscggsicmac[Constants::iikosyqiawkweouo] ?? []; } } } return $eioamqeaccimmisg; } public function yiesgoeqwoqskisc($umwqusowiqmyseom, $eioamqeaccimmisg = null, bool $maykoqyekaegigga = false) : ?string { if ($this->caokeucsksukesyo()->cqusmgskowmesgcg()->iqqgmieeqemiowuk('document', Constants::ycaueuokiswkqaoc)) { $gkkgcoiwayaccqgm = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->iooowgsqoyqseyuu($umwqusowiqmyseom); if ($oeomqqoymoecyuuu = $this->kmuweyayaqoeqiyw()) { $eioamqeaccimmisg = pr_utility_document_get_pdf()->wyqcekcuyecikkiq([Constants::waguuiqqgsysuukq => $oeomqqoymoecyuuu->wceqweesyywiouuy($gkkgcoiwayaccqgm), Constants::ysyaseouocgeqcyq => $this->akeqgiesemoyamwc(), Constants::gcqwukogwcmcuqqg => $maykoqyekaegigga, Constants::ssmskyqgcmeiayco => $this->icoiouesewicegau($umwqusowiqmyseom, $eioamqeaccimmisg), Constants::aeoikmkskgikaqmk => $this->qsqmumykksckouii($gkkgcoiwayaccqgm), Constants::oiwekasiocacwiik => 'woocommerce-invoice', Constants::eimosqqwcookwqow => $oeomqqoymoecyuuu->wceqweesyywiouuy($gkkgcoiwayaccqgm)]); } } return $eioamqeaccimmisg; } public function icoiouesewicegau($umwqusowiqmyseom, $eioamqeaccimmisg = null) : string { $ewgwqamkygiqaawc = ''; if ($umwqusowiqmyseom) { $swqimwqeweekeusq = $this->caokeucsksukesyo()->wgqqgewcmcemoewo(); $aqauykcugwiqkumq = $this->caokeucsksukesyo()->mmmcswscsiecscwg(); $yyauwyaeewsickwk = $this->caokeucsksukesyo()->owgcciayoweymuws(); $gkkgcoiwayaccqgm = $aqauykcugwiqkumq->iooowgsqoyqseyuu($umwqusowiqmyseom); $iiwwoeukeeweaisc = $aqauykcugwiqkumq->get($umwqusowiqmyseom); $qqscaoyqikuyeoaw = $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'template', 'template'); if (is_string($qqscaoyqikuyeoaw) && $qqscaoyqikuyeoaw) { $qggiqoewekaskuqo = $this->uwkmaywceaaaigwo()->giiuwsmyumqwwiyq()->ciqkaakiwsgqwiqu(Constants::NAME); $weowoqykiyuqcwam = $this->weysguygiseoukqw(Setting::syyucyyaoqwkoyww, ''); if ($weowoqykiyuqcwam) { $weowoqykiyuqcwam = $swqimwqeweekeusq->sokmmckycgmeesoa($this->caokeucsksukesyo()->iqsmaqoiukeasukw()->mgaeeqsgeoukeokc($weowoqykiyuqcwam), 100, 100); } if (!$weowoqykiyuqcwam) { $weowoqykiyuqcwam = $swqimwqeweekeusq->qgsekwygcgawekeq('h1', [], $qggiqoewekaskuqo); } if (empty($eioamqeaccimmisg)) { $eioamqeaccimmisg = $this->imasugowgqyekses($umwqusowiqmyseom); } $kqmcoiicsmgwaisg = $this->auqyiaissiuomqgs($umwqusowiqmyseom); $qookweymeqawmcwo = [ 'logo' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'logo', $weowoqykiyuqcwam, $umwqusowiqmyseom), 'font_family' => $this->akeqgiesemoyamwc(), 'pdf_title' => $this->muycisweeuoquemg(Constants::qescuiwgsyuikume, Setting::wmamggmmccsqcqwa, $umwqusowiqmyseom, $eioamqeaccimmisg, $kqmcoiicsmgwaisg), 'tax_number' => $this->muycisweeuoquemg(Invoice::qiookqywwgemeamk, Setting::qiookqywwgemeamk, $umwqusowiqmyseom, $eioamqeaccimmisg), 'tax_number_text' => $this->ecgckggomkiemwss(__('Tax Number', PR__MDL__WOOCOMMERCE_INVOICE), 'tax_number', $umwqusowiqmyseom), 'vat_number' => $this->muycisweeuoquemg(Invoice::kwmkawqoiesweswy, Setting::kwmkawqoiesweswy, $umwqusowiqmyseom, $eioamqeaccimmisg), 'vat_number_text' => $this->ecgckggomkiemwss(__('Vat Number', PR__MDL__WOOCOMMERCE_INVOICE), 'vat_number', $umwqusowiqmyseom), 'company_name' => $this->muycisweeuoquemg(Invoice::aockomuqgkgqyaki, Setting::aockomuqgkgqyaki, $umwqusowiqmyseom, $eioamqeaccimmisg), 'company_info' => nl2br($this->muycisweeuoquemg(Invoice::aockomuqgkgqyaki, Setting::aockomuqgkgqyaki, $umwqusowiqmyseom, $eioamqeaccimmisg)), 'company_number' => $this->muycisweeuoquemg(Invoice::kosymqioioyguigs, Setting::kosymqioioyguigs, $umwqusowiqmyseom, $eioamqeaccimmisg), 'company_number_text' => $this->ecgckggomkiemwss(__('Company Number', PR__MDL__WOOCOMMERCE_INVOICE), 'company_number', $umwqusowiqmyseom), 'registered_name' => $this->muycisweeuoquemg(Invoice::ekyyyewmowkgcgay, Setting::ekyyyewmowkgcgay, $umwqusowiqmyseom, $eioamqeaccimmisg), 'registered_name_text' => $this->ecgckggomkiemwss(__('Registered Name', PR__MDL__WOOCOMMERCE_INVOICE), 'registered_name', $umwqusowiqmyseom), 'registered_office' => $this->muycisweeuoquemg(Invoice::qaowyaoaqwacmgeo, Setting::qaowyaoaqwacmgeo, $umwqusowiqmyseom, $eioamqeaccimmisg), 'registered_office_text' => $this->ecgckggomkiemwss(__('Registered Office', PR__MDL__WOOCOMMERCE_INVOICE), 'registered_office', $umwqusowiqmyseom), 'invoice_num' => esc_html($this->aioemwomyweyeoug($gkkgcoiwayaccqgm)), 'invoice_num_text' => $this->ecgckggomkiemwss(__('Invoice No.', PR__MDL__WOOCOMMERCE_INVOICE), 'invoice_number', $umwqusowiqmyseom), 'order_num' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'order_number', $this->caokeucsksukesyo()->mmmcswscsiecscwg()->iyowqkwcwiuccgag($umwqusowiqmyseom), $umwqusowiqmyseom), 'order_num_text' => $this->ecgckggomkiemwss(__('Order No.', PR__MDL__WOOCOMMERCE_INVOICE), 'order_number', $umwqusowiqmyseom), 'invoice_date' => $this->wqmwuagkgieswuyk($umwqusowiqmyseom), 'invoice_date_text' => $this->ecgckggomkiemwss(__('Invoice Date', PR__MDL__WOOCOMMERCE_INVOICE), 'invoice_date', $umwqusowiqmyseom), 'order_date' => $this->wqmwuagkgieswuyk($umwqusowiqmyseom, false), 'order_date_text' => $this->ecgckggomkiemwss(__('Order Date', PR__MDL__WOOCOMMERCE_INVOICE), 'order_date', $umwqusowiqmyseom), 'billing_details_text' => $this->ecgckggomkiemwss(__('Billing Details', PR__MDL__WOOCOMMERCE_INVOICE), 'billing_details', $umwqusowiqmyseom), 'billing_address' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'billing_address', $this->caokeucsksukesyo()->mmmcswscsiecscwg()->ocgueeyoaeumuewk($umwqusowiqmyseom), $umwqusowiqmyseom), 'billing_phone' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'billing_phone', $this->caokeucsksukesyo()->mmmcswscsiecscwg()->gweagiaayiawoymg($umwqusowiqmyseom), $umwqusowiqmyseom), 'billing_email' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'billing_email', $this->caokeucsksukesyo()->mmmcswscsiecscwg()->gawoymkqiuigasuo($umwqusowiqmyseom), $umwqusowiqmyseom), 'shipping_details_text' => $this->ecgckggomkiemwss(__('Shipping Details', PR__MDL__WOOCOMMERCE_INVOICE), 'shipping_details', $umwqusowiqmyseom), 'shipping_address' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'shipping_address', $this->caokeucsksukesyo()->mmmcswscsiecscwg()->ucgsmqmcwaeyieeg($umwqusowiqmyseom), $umwqusowiqmyseom), 'payment_method_text' => $this->ecgckggomkiemwss(__('Payment Method', PR__MDL__WOOCOMMERCE_INVOICE), 'payment_method', $umwqusowiqmyseom), 'payment_method' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'payment_method', $this->caokeucsksukesyo()->mmmcswscsiecscwg()->sequoogokooiekma($umwqusowiqmyseom), $umwqusowiqmyseom), 'shipping_method_text' => $this->ecgckggomkiemwss(__('Shipping Method', PR__MDL__WOOCOMMERCE_INVOICE), 'shipping_method', $umwqusowiqmyseom), 'shipping_method' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'shipping_method', $this->caokeucsksukesyo()->mmmcswscsiecscwg()->gyiiseamqaqmymog($umwqusowiqmyseom), $umwqusowiqmyseom), 'details_text' => $this->ecgckggomkiemwss(__('Order Details', PR__MDL__WOOCOMMERCE_INVOICE), 'order_details', $umwqusowiqmyseom), 'columns' => $this->ywgcqoasqwkuyogk($umwqusowiqmyseom), 'details' => $this->yqiqkqiyauygumma($umwqusowiqmyseom), 'notes_text' => $this->ecgckggomkiemwss(__('Notes', PR__MDL__WOOCOMMERCE_INVOICE), 'order_notes', $umwqusowiqmyseom), 'notes' => $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'order_notes', $this->caokeucsksukesyo()->mmmcswscsiecscwg()->yucssmcwiiugkscy($umwqusowiqmyseom), $umwqusowiqmyseom), 'total_details' => $this->qywssmecoeqkyuiw($umwqusowiqmyseom), ]; $qookweymeqawmcwo = $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'content_parameters', $qookweymeqawmcwo); $ewgwqamkygiqaawc = $this->iuygowkemiiwqmiw($qqscaoyqikuyeoaw, $qookweymeqawmcwo); $ewgwqamkygiqaawc = $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'content_html', $ewgwqamkygiqaawc, $umwqusowiqmyseom, $qookweymeqawmcwo); } $ewgwqamkygiqaawc = $swqimwqeweekeusq->memaocoueygwyomc($ewgwqamkygiqaawc); } return $ewgwqamkygiqaawc; } public function akeqgiesemoyamwc() : string { return (string) $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'font_family', $this->weysguygiseoukqw(Setting::iwsaekkeqscgcwga, Setting::gucysgwowmaomwoo)); } public function ecgckggomkiemwss($pkyyagewkiyckmwy, $ymqmyyeuycgmigyo, $umwqusowiqmyseom) { return esc_html((string) $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . "{$ymqmyyeuycgmigyo}_label", $pkyyagewkiyckmwy, $umwqusowiqmyseom)); } public function muycisweeuoquemg($smswgeyucsuqowaw, $iiumgusgeekimkya, $umwqusowiqmyseom, $eioamqeaccimmisg, array $kqmcoiicsmgwaisg = []) : string { if (empty($eioamqeaccimmisg)) { $eioamqeaccimmisg = $this->imasugowgqyekses($umwqusowiqmyseom); } $eqgoocgaqwqcimie = null; if ($eioamqeaccimmisg) { $eqgoocgaqwqcimie = Invoice::symcgieuakksimmu()->waecsyqmwascmqoa($eioamqeaccimmisg, $smswgeyucsuqowaw); if ($eqgoocgaqwqcimie && $kqmcoiicsmgwaisg) { $eqgoocgaqwqcimie = $this->caokeucsksukesyo()->owgcciayoweymuws()->qquwggyuqouqumam($eqgoocgaqwqcimie, $kqmcoiicsmgwaisg); } } if (empty($eqgoocgaqwqcimie)) { $eqgoocgaqwqcimie = $this->weysguygiseoukqw($iiumgusgeekimkya); } return (string) $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . $smswgeyucsuqowaw, $eqgoocgaqwqcimie, $umwqusowiqmyseom, $eioamqeaccimmisg); } public function imasugowgqyekses($umwqusowiqmyseom) : array { $eioamqeaccimmisg = []; if ($gkkgcoiwayaccqgm = $this->ayyeiqikwseeegqg($umwqusowiqmyseom)) { $eioamqeaccimmisg = (array) Invoice::symcgieuakksimmu()->iekyeyicoyyawomk()->akkkoiiymmamsauc($gkkgcoiwayaccqgm, Constants::geykusaewkemcasi); } return $eioamqeaccimmisg; } public function eacciqkqyiyiawiy($umwqusowiqmyseom, $aiowsaccomcoikus) { return $this->ocksiywmkyaqseou("woocommerce_invoice_field_{$aiowsaccomcoikus}", $this->weysguygiseoukqw($aiowsaccomcoikus), $umwqusowiqmyseom); } public function aioemwomyweyeoug($gkkgcoiwayaccqgm) { if (!$this->weysguygiseoukqw(Setting::gooouyogomkqyiwa)) { $egaioscwooawuigc = $gkkgcoiwayaccqgm; } else { $egaioscwooawuigc = $this->sywqsimcesscwamc(); } $egaioscwooawuigc = $this->ocksiywmkyaqseou('woocommerce_invoice_number', $egaioscwooawuigc, $gkkgcoiwayaccqgm); $this->kmuweyayaqoeqiyw()->qioweyiqewmsocem(Setting::ysoqycicuciiyuaw, $egaioscwooawuigc); return $egaioscwooawuigc; } public function oemgogkymyscaiiw($gkkgcoiwayaccqgm, $egaioscwooawuigc) : string { $yyauwyaeewsickwk = $this->caokeucsksukesyo()->owgcciayoweymuws(); $kqmcoiicsmgwaisg = [Constants::awkcoioakcaougmq => $gkkgcoiwayaccqgm]; $yuwymayicwwqiske = $yyauwyaeewsickwk->qquwggyuqouqumam(esc_html($this->weysguygiseoukqw(Setting::mqcukmwiaqukgywi)), $kqmcoiicsmgwaisg); $scqcgogsiaiksiiq = $yyauwyaeewsickwk->qquwggyuqouqumam(esc_html($this->weysguygiseoukqw(Setting::wywskiqiowiagemy)), $kqmcoiicsmgwaisg); if ($wukmmiqowweyucaa = $this->weysguygiseoukqw(Setting::osgqakokgccsywgw)) { $egaioscwooawuigc = str_pad($egaioscwooawuigc, strlen($wukmmiqowweyucaa), "0", STR_PAD_LEFT); } return $yuwymayicwwqiske . $egaioscwooawuigc . $scqcgogsiaiksiiq; } public function sywqsimcesscwamc() { $yeacayasgueouoqc = null; $wsgaqoyasieoiwuw = $this->weysguygiseoukqw(Setting::aegqguumccieqwyk); $eqwoegegiamegqsm = $this->caokeucsksukesyo()->skckwsgymkimyuwo(); $ceccweccosegwysu = Invoice::symcgieuakksimmu(); $uoomaookgsyciacm = [$eqwoegegiamegqsm->owogyemaccuymycq($ceccweccosegwysu->kumuygiiqswoyasy())->yogqsokgsqemsuoq()]; if ($wsgaqoyasieoiwuw) { $yooaaeuioeawcqms = date('Y-01-01'); $seusouwwgeqagsce = date('Y-12-31'); $uoomaookgsyciacm[] = $eqwoegegiamegqsm->megqywqeuquawkim(Constants::CREATED_AT, [$yooaaeuioeawcqms, $seusouwwgeqagsce])->wiqiksaowkoeiymu()->yaoukqkouaeeycuy(); } $maaweyqaqmgqqkgw = $ceccweccosegwysu->iekyeyicoyyawomk()->oqomcmyuuakigusk($uoomaookgsyciacm); if ($maaweyqaqmgqqkgw) { $yeacayasgueouoqc = $ceccweccosegwysu->waecsyqmwascmqoa($maaweyqaqmgqqkgw, $ceccweccosegwysu::aeoiqogeqsmoaaai); } if (empty($yeacayasgueouoqc)) { $mmwoqcwiwemokkue = 1; if ($mesieoomaagsgyqe = $this->weysguygiseoukqw(Setting::uumqsyagoeuaaimw, 0)) { $mmwoqcwiwemokkue = $mesieoomaagsgyqe; } } else { $mmwoqcwiwemokkue = $yeacayasgueouoqc + 1; } $acwmgkosiwekkosk = $this->weysguygiseoukqw(Setting::ysoqycicuciiyuaw, 0); if (!$wsgaqoyasieoiwuw && $acwmgkosiwekkosk > $mmwoqcwiwemokkue) { $mmwoqcwiwemokkue = $acwmgkosiwekkosk; } return (int) max(1, (int) $mmwoqcwiwemokkue); } public function mucewuasaoaeekuo() : ?string { return $this->uwkmaywceaaaigwo()->gksccikkaamikckm()->key(Customer::class); } public function gaisoeyogkaguouo($umwqusowiqmyseom) { $woocommerce = $this->caokeucsksukesyo()->wikusamwomuogoau()->wcmmcciyowmqwmyc(); if ($woocommerce) { $ockoeumsksqeoiyo = $woocommerce->mailer(); if ($ockoeumsksqeoiyo) { $awwassyawiguwyua = $ockoeumsksqeoiyo->emails; $owaiikyuwwwmswgc = $awwassyawiguwyua[$this->mucewuasaoaeekuo()] ?? false; if ($owaiikyuwwwmswgc instanceof Customer) { $owaiikyuwwwmswgc->kgimeakisikksgce($umwqusowiqmyseom); } } } } public function wsoewyimgeueicci($umwqusowiqmyseom, $eeamcawaiqocomwy = null) : string { if (!$eeamcawaiqocomwy) { $eeamcawaiqocomwy = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->ekcymmyqoceukosc(true); } $gkkgcoiwayaccqgm = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->iooowgsqoyqseyuu($umwqusowiqmyseom); $iiwwoeukeeweaisc = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->get($umwqusowiqmyseom); $eewgkagwsoswegks = ''; if ($gkkgcoiwayaccqgm && $iiwwoeukeeweaisc) { $eewgkagwsoswegks = $this->uwkmaywceaaaigwo()->owicscwgeuqcqaig()->yqymaqmqiqmmmsoo([Order::woacsaigwaqsmqaa => $gkkgcoiwayaccqgm, Order::geeoyiwewgeekiuk => wp_hash($iiwwoeukeeweaisc->get_order_key(), 'nonce')], $eeamcawaiqocomwy); } return $eewgkagwsoswegks; } public function ayyeiqikwseeegqg($umwqusowiqmyseom = null) { if (is_numeric($umwqusowiqmyseom)) { return $umwqusowiqmyseom; } if ($umwqusowiqmyseom instanceof WC_Order) { return $this->caokeucsksukesyo()->mmmcswscsiecscwg()->iooowgsqoyqseyuu($umwqusowiqmyseom); } if ($umwqusowiqmyseom instanceof WP_Post || is_array($umwqusowiqmyseom)) { return $this->caokeucsksukesyo()->ayueggmoqeeukqmq()->iooowgsqoyqseyuu($umwqusowiqmyseom); } return 0; } public function awwskyoimucwkeoa() : array { $sscaicokimsuuiyw = $this->weysguygiseoukqw(Setting::cysoyggakakyywwg, Constants::amcogigwsaqssuai); $oqseeekuqisekiwy = []; switch ($sscaicokimsuuiyw) { case Constants::eaaqiksmkkksomaa: $oqseeekuqisekiwy = [Constants::qgmyyeewkieecqck, Constants::amcogigwsaqssuai, Constants::sgoswgskyiiwkyuo, Constants::eaaqiksmkkksomaa]; break; case Constants::sgoswgskyiiwkyuo: $oqseeekuqisekiwy = [Constants::qgmyyeewkieecqck, Constants::amcogigwsaqssuai, Constants::sgoswgskyiiwkyuo]; break; case Constants::qgmyyeewkieecqck: $oqseeekuqisekiwy = [Constants::qgmyyeewkieecqck, Constants::amcogigwsaqssuai]; break; case Constants::amcogigwsaqssuai: $oqseeekuqisekiwy = [Constants::amcogigwsaqssuai]; break; } return $this->ocksiywmkyaqseou(WoocommerceInvoice::ccwyisoeggcoicio . 'order_statuses', $oqseeekuqisekiwy, $sscaicokimsuuiyw); } public function kqwooiaaasycksaq($umwqusowiqmyseom) : ?string { $ocogsiouoiuuguym = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->sayeeewgsiaaskww($umwqusowiqmyseom); if (!$ocogsiouoiuuguym) { $eioamqeaccimmisg = $this->imasugowgqyekses($umwqusowiqmyseom); if (!empty($eioamqeaccimmisg)) { $ogegikscwkaowsqa = Invoice::symcgieuakksimmu()->waecsyqmwascmqoa($eioamqeaccimmisg, Constants::CREATED_AT); if ($ogegikscwkaowsqa) { $ocogsiouoiuuguym = $ogegikscwkaowsqa; } } } return $ocogsiouoiuuguym; } public function wqmwuagkgieswuyk($umwqusowiqmyseom, bool $iimkgmiaaiqwwowy = true) { $ocogsiouoiuuguym = null; $aqauykcugwiqkumq = $this->caokeucsksukesyo()->mmmcswscsiecscwg(); $umwqusowiqmyseom = $aqauykcugwiqkumq->get($umwqusowiqmyseom); if ($umwqusowiqmyseom) { if ($iimkgmiaaiqwwowy) { $ocogsiouoiuuguym = $this->kqwooiaaasycksaq($umwqusowiqmyseom); } if (!$ocogsiouoiuuguym) { $ocogsiouoiuuguym = $umwqusowiqmyseom->get_date_created(); } $qquguecmwwmwomew = $this->weysguygiseoukqw(Setting::omaocaaweuesmwwu, Setting::gocgkgumeiwkkkog); $saqmwwmqiwmkiwaa = $this->caokeucsksukesyo()->eiwcuqigayigimak()->yoaaussmackoisuw(); $wucumyeqeqigucwy = DateTime::createFromFormat($saqmwwmqiwmkiwaa, $ocogsiouoiuuguym); if ($wucumyeqeqigucwy) { $ocogsiouoiuuguym = $wucumyeqeqigucwy->format($qquguecmwwmwomew); } if ($cqgoimumaewouews = strtotime($ocogsiouoiuuguym)) { $ocogsiouoiuuguym = date_i18n($saqmwwmqiwmkiwaa, $cqgoimumaewouews); } } return $this->ocksiywmkyaqseou(WoocommerceInvoice::ccwyisoeggcoicio . 'display_date', $ocogsiouoiuuguym, $umwqusowiqmyseom); } public function qsqmumykksckouii($umwqusowiqmyseom) : string { $gkkgcoiwayaccqgm = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->iooowgsqoyqseyuu($umwqusowiqmyseom); $wkcwykowmmmwioqs = $this->weysguygiseoukqw(Setting::iycawcqkciwyayiy, ''); if (!$wkcwykowmmmwioqs) { $wkcwykowmmmwioqs = $this->uwkmaywceaaaigwo()->giiuwsmyumqwwiyq()->ciqkaakiwsgqwiqu(Constants::NAME) . "-{$gkkgcoiwayaccqgm}"; } else { $wkcwykowmmmwioqs = $this->caokeucsksukesyo()->owgcciayoweymuws()->qquwggyuqouqumam($wkcwykowmmmwioqs, $this->auqyiaissiuomqgs($umwqusowiqmyseom)); } $wkcwykowmmmwioqs = $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'filename', $wkcwykowmmmwioqs, $gkkgcoiwayaccqgm); return $this->uwkmaywceaaaigwo()->gksccikkaamikckm()->wkcwykowmmmwioqs($wkcwykowmmmwioqs); } public function auqyiaissiuomqgs($umwqusowiqmyseom) : array { $qqueccegigsqmmmg = []; $kegkegukuqqiakko = ['H' => 'G', 'HH' => 'H', 'D' => 'j', 'DD' => 'd', 'M' => 'n', 'N' => 'i', 'S' => 's', 'MM' => 'm', 'YY' => 'y', 'yy' => 'y', 'YYYY' => 'Y', 'year' => 'Y', 'YEAR' => 'Y', 'mon' => 'M', 'month' => 'F']; $qggiqoewekaskuqo = $this->uwkmaywceaaaigwo()->giiuwsmyumqwwiyq()->ciqkaakiwsgqwiqu(Constants::NAME); if ($umwqusowiqmyseom) { if ($ocogsiouoiuuguym = $this->wqmwuagkgieswuyk($umwqusowiqmyseom)) { foreach ($kegkegukuqqiakko as $uusmaiomayssaecw => $saqmwwmqiwmkiwaa) { $qqueccegigsqmmmg[$uusmaiomayssaecw] = date($saqmwwmqiwmkiwaa, strtotime($ocogsiouoiuuguym)); } } $gkkgcoiwayaccqgm = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->iooowgsqoyqseyuu($umwqusowiqmyseom); $ogegikscwkaowsqa = $this->wqmwuagkgieswuyk($umwqusowiqmyseom); $egaioscwooawuigc = esc_html($this->aioemwomyweyeoug($gkkgcoiwayaccqgm)); if (!$egaioscwooawuigc) { $egaioscwooawuigc = $gkkgcoiwayaccqgm; } $osseiiwmsakcyeqi = $this->weysguygiseoukqw(Setting::aockomuqgkgqyaki, $qggiqoewekaskuqo); $qgowgcsuycquswmo = ['company' => $osseiiwmsakcyeqi, 'invoice_date' => $ogegikscwkaowsqa, 'invoice_number' => $egaioscwooawuigc]; foreach ($qgowgcsuycquswmo as $uusmaiomayssaecw => $mmomgiqeqykoeukg) { $qqueccegigsqmmmg[$uusmaiomayssaecw] = $mmomgiqeqykoeukg; } } return $qqueccegigsqmmmg; } public function ywgcqoasqwkuyogk($umwqusowiqmyseom) { $wkkweuacukumqmya = [Constants::oguseymmyyoyaako => ['align' => 'left', Constants::qescuiwgsyuikume => __('Product', PR__MDL__WOOCOMMERCE_INVOICE), Constants::qomookamaskuoswk => 50, Constants::iuqumwggccmcuyem => 0], Constants::eqkiuiogcaeskmgu => [Constants::qescuiwgsyuikume => __('Qty', PR__MDL__WOOCOMMERCE_INVOICE), Constants::qomookamaskuoswk => 5, Constants::iuqumwggccmcuyem => 1], Constants::acymsykymkiewqsy => [Constants::qescuiwgsyuikume => __('Price Ex', PR__MDL__WOOCOMMERCE_INVOICE), Constants::qomookamaskuoswk => 9, Constants::iuqumwggccmcuyem => 2], Constants::uiiqiokqwmccomiu => [Constants::qescuiwgsyuikume => __('Total Ex.', PR__MDL__WOOCOMMERCE_INVOICE), Constants::qomookamaskuoswk => 9, Constants::iuqumwggccmcuyem => 3], self::kyicykyuagcqogqm => [Constants::qescuiwgsyuikume => __('Tax', PR__MDL__WOOCOMMERCE_INVOICE), Constants::qomookamaskuoswk => 7, Constants::iuqumwggccmcuyem => 4], self::keeemscwmacsykou => [Constants::qescuiwgsyuikume => __('Price Inc', PR__MDL__WOOCOMMERCE_INVOICE), Constants::qomookamaskuoswk => 10, Constants::iuqumwggccmcuyem => 5], self::augaaessqicgceuq => [Constants::qescuiwgsyuikume => __('Total Inc', PR__MDL__WOOCOMMERCE_INVOICE), Constants::qomookamaskuoswk => 10, Constants::iuqumwggccmcuyem => 6]]; $wkkweuacukumqmya = (array) $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'table_columns', $wkkweuacukumqmya, $umwqusowiqmyseom); return $this->caokeucsksukesyo()->ywqgcuymeiswqyqc()->yaeiiwwyckwugsem($wkkweuacukumqmya); } public function yqiqkqiyauygumma($umwqusowiqmyseom) { $wkkweuacukumqmya = $this->ywgcqoasqwkuyogk($umwqusowiqmyseom); $yigswkamgakyoaww = []; if ($wkkweuacukumqmya) { $iiwwoeukeeweaisc = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->get($umwqusowiqmyseom); if ($iiwwoeukeeweaisc) { $oammesyieqmwuwyi = $iiwwoeukeeweaisc->get_items(); if (count($oammesyieqmwuwyi) > 0) { $cgceoyqmmwumqyqa = $this->uwkmaywceaaaigwo()->wikusamwomuogoau(); $ikiwgyeauqgsoasu = [Constants::CURRENCY => $iiwwoeukeeweaisc->get_currency()]; foreach ($oammesyieqmwuwyi as $igqsaukqcqscimok) { if ($igqsaukqcqscimok instanceof WC_Order_Item_Product) { $mkgcaseqyaayywqo = $igqsaukqcqscimok->get_quantity(); if ($mkgcaseqyaayywqo) { $aokagokqyuysuksm = $igqsaukqcqscimok->get_id(); $product = $igqsaukqcqscimok->get_product(); $oammesyieqmwuwyi = []; $uuwmqqqiwksuaise = $igqsaukqcqscimok->get_total(); $qeuwceeoyokwcoyw = $igqsaukqcqscimok->get_total_tax(); foreach (array_keys($wkkweuacukumqmya) as $qgoqiacsiccwoawi) { $eqgoocgaqwqcimie = ''; switch ($qgoqiacsiccwoawi) { case Constants::eqkiuiogcaeskmgu: $eqgoocgaqwqcimie = $mkgcaseqyaayywqo; break; case Constants::oguseymmyyoyaako: $eqgoocgaqwqcimie = $this->koayykkeegycukks($igqsaukqcqscimok, $umwqusowiqmyseom); break; case Constants::acymsykymkiewqsy: $eqgoocgaqwqcimie = $cgceoyqmmwumqyqa->aumscagymwyyicag($uuwmqqqiwksuaise / $mkgcaseqyaayywqo, $ikiwgyeauqgsoasu); break; case Constants::uiiqiokqwmccomiu: $eqgoocgaqwqcimie = $cgceoyqmmwumqyqa->aumscagymwyyicag($uuwmqqqiwksuaise, $ikiwgyeauqgsoasu); break; case self::kyicykyuagcqogqm: $eqgoocgaqwqcimie = $cgceoyqmmwumqyqa->aumscagymwyyicag($qeuwceeoyokwcoyw / $mkgcaseqyaayywqo, $ikiwgyeauqgsoasu); break; case self::keeemscwmacsykou: $eqgoocgaqwqcimie = $cgceoyqmmwumqyqa->aumscagymwyyicag($uuwmqqqiwksuaise + $qeuwceeoyokwcoyw / $mkgcaseqyaayywqo, $ikiwgyeauqgsoasu); break; case self::augaaessqicgceuq: $eqgoocgaqwqcimie = $cgceoyqmmwumqyqa->aumscagymwyyicag($uuwmqqqiwksuaise + $qeuwceeoyokwcoyw, $ikiwgyeauqgsoasu); break; default: $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . "order_details_{$qgoqiacsiccwoawi}_value", '', $igqsaukqcqscimok, $product, $umwqusowiqmyseom); break; } $oammesyieqmwuwyi[$qgoqiacsiccwoawi] = $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'details_value', $eqgoocgaqwqcimie, $qgoqiacsiccwoawi, $igqsaukqcqscimok, $product, $umwqusowiqmyseom); } $yigswkamgakyoaww[$aokagokqyuysuksm] = $oammesyieqmwuwyi; } } } } } } return $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'table_details', $yigswkamgakyoaww, $umwqusowiqmyseom); } public function koayykkeegycukks($igqsaukqcqscimok, $umwqusowiqmyseom) { $ymqmyyeuycgmigyo = ''; if ($igqsaukqcqscimok instanceof WC_Order_Item_Product) { $ymqmyyeuycgmigyo = $igqsaukqcqscimok->get_name(); $kuguwoaesuqsqysu = []; foreach ($igqsaukqcqscimok->get_formatted_meta_data() as $ugugimquukqwogge) { $kuguwoaesuqsqysu[] = sprintf('<br/><small>%s: %s</small>', $ugugimquukqwogge[Constants::cuyqkgecokgmcwqu] ?? '', wp_kses_post($ugugimquukqwogge[Constants::ikqqikmyqgwwmoqm] ?? '')); } $kuguwoaesuqsqysu = $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'metadata', $kuguwoaesuqsqysu, $umwqusowiqmyseom); if (is_array($kuguwoaesuqsqysu) && $kuguwoaesuqsqysu) { $ymqmyyeuycgmigyo .= implode('', $kuguwoaesuqsqysu); } } return $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'order_item_name', $ymqmyyeuycgmigyo, $igqsaukqcqscimok, $umwqusowiqmyseom); } public function qywssmecoeqkyuiw($umwqusowiqmyseom) { $csumamqkuwmeqkkg = []; $iiwwoeukeeweaisc = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->get($umwqusowiqmyseom); if ($iiwwoeukeeweaisc) { $oammesyieqmwuwyi = [self::uugwyiqaimqysamw => [Constants::qescuiwgsyuikume => __('Subtotal', PR__MDL__WOOCOMMERCE_INVOICE), Constants::iuqumwggccmcuyem => 0], self::kockquwamkwwwwok => [Constants::qescuiwgsyuikume => __('Shipping', PR__MDL__WOOCOMMERCE_INVOICE), Constants::iuqumwggccmcuyem => 1], self::uueoqmeyyeiqyuku => [Constants::qescuiwgsyuikume => __('Discount', PR__MDL__WOOCOMMERCE_INVOICE), Constants::iuqumwggccmcuyem => 2], self::kyicykyuagcqogqm => [Constants::qescuiwgsyuikume => __('Tax', PR__MDL__WOOCOMMERCE_INVOICE), Constants::iuqumwggccmcuyem => 2], Constants::uiiqiokqwmccomiu => [Constants::qescuiwgsyuikume => __('Grand Total', PR__MDL__WOOCOMMERCE_INVOICE), Constants::iuqumwggccmcuyem => 3], self::euacueckgccyumqw => [Constants::qescuiwgsyuikume => __('Totals', PR__MDL__WOOCOMMERCE_INVOICE), Constants::iuqumwggccmcuyem => 4]]; $oammesyieqmwuwyi = (array) $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'order_totals_items', $oammesyieqmwuwyi, $umwqusowiqmyseom); $oammesyieqmwuwyi = $this->caokeucsksukesyo()->ywqgcuymeiswqyqc()->yaeiiwwyckwugsem($oammesyieqmwuwyi); $ikiwgyeauqgsoasu = [Constants::CURRENCY => $iiwwoeukeeweaisc->get_currency()]; $cgceoyqmmwumqyqa = $this->uwkmaywceaaaigwo()->wikusamwomuogoau(); foreach ($oammesyieqmwuwyi as $uusmaiomayssaecw => $igqsaukqcqscimok) { $eqgoocgaqwqcimie = []; switch ($uusmaiomayssaecw) { case self::kyicykyuagcqogqm: if ($iiwwoeukeeweaisc->get_total_tax() > 0) { $cuekquqwwskueusk = $iiwwoeukeeweaisc->get_tax_totals(); $momcykaoccoymeig = 0; foreach ($cuekquqwwskueusk as $mmygesumywqsoece) { $eqgoocgaqwqcimie[] = [Constants::qescuiwgsyuikume => $mmygesumywqsoece[Constants::uissasisiuymwsmu] ?? '', Constants::ciyoccqkiamemcmm => $cgceoyqmmwumqyqa->aumscagymwyyicag($mmygesumywqsoece[Constants::aioqyewkwawaqgqe] ?? 0, $ikiwgyeauqgsoasu), Constants::iuqumwggccmcuyem => 30 + $momcykaoccoymeig]; $momcykaoccoymeig++; } if (count($cuekquqwwskueusk) > 1) { $eqgoocgaqwqcimie[] = [Constants::qescuiwgsyuikume => __('Total Tax', PR__MDL__WOOCOMMERCE_INVOICE), Constants::ciyoccqkiamemcmm => $cgceoyqmmwumqyqa->aumscagymwyyicag($iiwwoeukeeweaisc->get_total_tax(), $ikiwgyeauqgsoasu), Constants::iuqumwggccmcuyem => 30 + $momcykaoccoymeig]; } } break; case Constants::uiiqiokqwmccomiu: $eqgoocgaqwqcimie = $cgceoyqmmwumqyqa->aumscagymwyyicag($iiwwoeukeeweaisc->get_total(), $ikiwgyeauqgsoasu); break; case self::euacueckgccyumqw: $iuueykkqoqwykyce = $iiwwoeukeeweaisc->get_order_item_totals(); unset($iuueykkqoqwykyce['payment_method']); $eqgoocgaqwqcimie = []; $momcykaoccoymeig = 0; foreach ($iuueykkqoqwykyce as $ciyackuwsqkoqese => $kwgwucweqckaqwyc) { $eqgoocgaqwqcimie[$ciyackuwsqkoqese] = [Constants::qescuiwgsyuikume => $kwgwucweqckaqwyc[Constants::uissasisiuymwsmu] ?? '', Constants::ciyoccqkiamemcmm => $kwgwucweqckaqwyc[Constants::ciyoccqkiamemcmm] ?? '', Constants::iuqumwggccmcuyem => 500 + $momcykaoccoymeig]; $momcykaoccoymeig++; } if ($oiwucmouwegwaqoi = $iiwwoeukeeweaisc->get_total_refunded()) { $eqgoocgaqwqcimie['refunded'] = [Constants::qescuiwgsyuikume => __('Amount Refunded', PR__MDL__WOOCOMMERCE_INVOICE), Constants::ciyoccqkiamemcmm => $cgceoyqmmwumqyqa->aumscagymwyyicag($oiwucmouwegwaqoi, $ikiwgyeauqgsoasu), Constants::iuqumwggccmcuyem => 500 + $momcykaoccoymeig]; } break; case self::uugwyiqaimqysamw: $eqgoocgaqwqcimie = $iiwwoeukeeweaisc->get_subtotal_to_display(); break; case self::kockquwamkwwwwok: $eqgoocgaqwqcimie = $iiwwoeukeeweaisc->get_shipping_to_display(); break; case self::uueoqmeyyeiqyuku: $wewsywccwwomowkw = $iiwwoeukeeweaisc->get_total_discount(); $oseauckgaqkwykmi = $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'order_discount_negative', '-', $umwqusowiqmyseom); $aeqcomiyowaiwgyg = $this->aqeaaucuoimyawoo($umwqusowiqmyseom); $eqgoocgaqwqcimie = [$aeqcomiyowaiwgyg, $oseauckgaqkwykmi . $cgceoyqmmwumqyqa->aumscagymwyyicag($wewsywccwwomowkw, $ikiwgyeauqgsoasu)]; break; } $eqgoocgaqwqcimie = $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . "order_{$uusmaiomayssaecw}", $eqgoocgaqwqcimie, $umwqusowiqmyseom); if ($eqgoocgaqwqcimie) { if (is_array($eqgoocgaqwqcimie) && in_array($uusmaiomayssaecw, [self::euacueckgccyumqw, self::kyicykyuagcqogqm], true)) { $csumamqkuwmeqkkg = array_merge($csumamqkuwmeqkkg, $eqgoocgaqwqcimie); } else { $csumamqkuwmeqkkg[$uusmaiomayssaecw] = array_merge($igqsaukqcqscimok, [Constants::ciyoccqkiamemcmm => $eqgoocgaqwqcimie]); } } } } return $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'order_total_details', $csumamqkuwmeqkkg, $umwqusowiqmyseom); } public function aqeaaucuoimyawoo($umwqusowiqmyseom) : string { $sogksuscggsicmac = ''; $iiwwoeukeeweaisc = $this->caokeucsksukesyo()->mmmcswscsiecscwg()->get($umwqusowiqmyseom); if ($iiwwoeukeeweaisc) { $qggesccwkmygeoec = is_callable([$iiwwoeukeeweaisc, 'get_coupon_codes']) ? $iiwwoeukeeweaisc->get_coupon_codes() : $iiwwoeukeeweaisc->get_used_coupons(); if ($qggesccwkmygeoec) { $gaeqamemwmwsyukm = count($qggesccwkmygeoec); $qogukaieewsqqcqy = implode(', ', $qggesccwkmygeoec); $sogksuscggsicmac = '<br/>' . $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->ciuuiyckmsygceis(sprintf('%s (%s):', __('Coupons used', PR__MDL__WOOCOMMERCE_INVOICE), $gaeqamemwmwsyukm)) . $qogukaieewsqqcqy; } } return $this->ocksiywmkyaqseou(self::ikwcgqkqmakcmwwg . 'order_coupons', $sogksuscggsicmac, $umwqusowiqmyseom); } }
